rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(
//    /databases/(default)/documents/users/$(request.auth.uid)).data.isAdmin;
service firebase.storage {
  match /b/{bucket}/o {
    // Regole per consentire l'accesso con CORS appropriato
    // e limiti di dimensione file per le diverse risorse
    
    // Regola base per tutti i file
    match /{allPaths=**} {
      // Consenti lettura pubblica a tutti i file
      allow read: if true;
      
      // Consenti scrittura agli utenti autenticati
      allow write: if request.auth != null && 
        (request.resource == null || request.resource.size <= 50 * 1024 * 1024);
    }
    
    // Regole specifiche per modelli 3D
    match /files/{userId}/{fileName} {
      allow read: if true;  // Accesso pubblico per lettura
      allow write: if request.auth != null && 
        (request.auth.uid == userId || 
         request.auth.token.email == "info@3dmakes.ch");
    }
    
    // Regole specifiche per i progetti
    match /projects/{userId}/{fileName} {
      allow read: if true;  // Accesso pubblico per lettura
      allow write: if request.auth != null && 
        (request.auth.uid == userId || 
         request.auth.token.email == "info@3dmakes.ch");
    }
  }
}
